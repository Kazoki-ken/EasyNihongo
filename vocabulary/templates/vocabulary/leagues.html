{% extends 'vocabulary/base.html' %}
{% load static %}

{% block content %}
<style>
    /* Default (Light Mode) User Card */
    .user-league-card {
        background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
        border: none;
    }

    /* DARK MODE STYLES */
    body.dark-mode .user-league-card {
        background: linear-gradient(135deg, #1e1e1e 0%, #2c2c2c 100%) !important;
        border: 1px solid #333 !important;
    }

    /* Dark Mode Table Fixes */
    body.dark-mode .table {
        --bs-table-bg: #1e1e1e;
        --bs-table-color: #e0e0e0;
        --bs-table-hover-bg: #2c2c2c;
        --bs-table-border-color: #333;
        color: #e0e0e0;
    }

    /* Table Header in Dark Mode */
    body.dark-mode .bg-light {
        background-color: #2c2c2c !important;
        color: #fff !important;
    }

    /* Active Row in Dark Mode */
    body.dark-mode .table-active {
        --bs-table-active-bg: #333;
        --bs-table-active-color: #fff;
        background-color: #333 !important; /* Force override */
    }

    /* Rank Icons & Text in Dark Mode */
    body.dark-mode .text-dark {
        color: #fff !important;
    }

    body.dark-mode .text-secondary {
        color: #adb5bd !important; /* Lighter grey for better contrast */
    }

    /* Row Highlights (Success/Danger) in Dark Mode */
    body.dark-mode .bg-success.bg-opacity-10 {
        background-color: rgba(25, 135, 84, 0.2) !important;
    }
    body.dark-mode .bg-danger.bg-opacity-10 {
        background-color: rgba(220, 53, 69, 0.2) !important;
    }
</style>

<div class="container py-4">
    <!-- LEAGUE HEADER -->
    <div class="text-center mb-4">
        <h2 class="fw-bold mb-1" style="color:
            {% if current_league == 'Bronze' %}#cd7f32
            {% elif current_league == 'Silver' %}#c0c0c0
            {% elif current_league == 'Gold' %}#ffd700
            {% elif current_league == 'Platinum' %}#e5e4e2
            {% elif current_league == 'Diamond' %}#b9f2ff
            {% endif %};
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);">

            {% if current_league == 'Bronze' %}ðŸ¥‰ Bronze
            {% elif current_league == 'Silver' %}ðŸ¥ˆ Silver
            {% elif current_league == 'Gold' %}ðŸ¥‡ Gold
            {% elif current_league == 'Platinum' %}ðŸ’Ž Platinum
            {% elif current_league == 'Diamond' %}ðŸ‘‘ Diamond
            {% endif %} League
        </h2>
        <p class="text-muted small">Haftalik bellashuv yakshanba kuni tugaydi</p>
    </div>

    <!-- CURRENT USER STATS -->
    <div class="card shadow-sm rounded-4 mb-4 user-league-card">
        <div class="card-body d-flex align-items-center justify-content-between p-3">
            <div class="d-flex align-items-center">
                <div class="rounded-circle bg-white shadow-sm d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
                    <i class="bi bi-person-fill fs-3 text-secondary"></i>
                </div>
                <div>
                    <h6 class="fw-bold mb-0 text-dark">{{ user.username }}</h6>
                    <small class="text-muted">Rank: #{{ user_rank }}</small>
                </div>
            </div>
            <div class="text-end">
                <h5 class="fw-bold text-primary mb-0">{{ current_user_xp|default:0 }} XP</h5>
                <small class="text-muted">Bu hafta</small>
            </div>
        </div>
    </div>

    <!-- LEADERBOARD TABLE -->
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="card-header bg-white border-0 py-3">
            <h6 class="fw-bold mb-0 text-secondary"><i class="bi bi-trophy-fill me-2 text-warning"></i>Jadval</h6>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4 border-0" style="width: 10%;">#</th>
                        <th class="border-0" style="width: 60%;">Foydalanuvchi</th>
                        <th class="text-end pe-4 border-0" style="width: 30%;">XP</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in leaderboard_data %}
                        <tr class="
                            {% if forloop.counter <= 5 and current_league != 'Diamond' %}bg-success bg-opacity-10
                            {% elif forloop.revcounter <= 5 and current_league != 'Bronze' and leaderboard_data|length > 5 %}bg-danger bg-opacity-10
                            {% endif %}
                            {% if item.profile.user == user %}table-active border-start border-4 border-primary{% endif %}
                        ">
                            <td class="ps-4 fw-bold text-secondary">
                                {% if forloop.counter == 1 %}ðŸ¥‡
                                {% elif forloop.counter == 2 %}ðŸ¥ˆ
                                {% elif forloop.counter == 3 %}ðŸ¥‰
                                {% else %}{{ forloop.counter }}
                                {% endif %}
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle bg-secondary bg-opacity-10 d-flex align-items-center justify-content-center me-2" style="width: 35px; height: 35px; font-size: 0.8rem;">
                                        {{ item.profile.user.username|slice:":2"|upper }}
                                    </div>
                                    <span class="fw-semibold {% if item.profile.user == user %}text-primary{% endif %} text-dark">
                                        {{ item.profile.user.username }}
                                    </span>
                                    {% if forloop.counter <= 5 and current_league != 'Diamond' %}
                                        <i class="bi bi-arrow-up-short text-success ms-2" title="Ko'tarilish zonasida"></i>
                                    {% elif forloop.revcounter <= 5 and current_league != 'Bronze' and leaderboard_data|length > 5 %}
                                        <i class="bi bi-arrow-down-short text-danger ms-2" title="Tushish zonasida"></i>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="text-end pe-4 fw-bold text-dark">{{ item.xp }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="3" class="text-center py-4 text-muted">
                                Hozircha hech kim o'ynamadi. Birinchi bo'ling!
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="text-center mt-3">
        <small class="text-muted"><i class="bi bi-info-circle me-1"></i> Top 5 yuqoriga, oxirgi 5 pastga tushadi.</small>
    </div>
</div>
{% endblock %}
