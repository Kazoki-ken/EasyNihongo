<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sakura Gakuen</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* --- SIZNING ASL DIZAYNINGIZ (Hech narsa o'zgarmadi) --- */
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f8f9fa; 
            padding-bottom: 90px; 
        }

        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.05);
            padding: 10px 0 15px 0;
            z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.03);
        }

        .nav-item-custom {
            text-align: center; color: #adb5bd;
            text-decoration: none; transition: all 0.3s ease;
            position: relative;
        }

        .nav-item-custom i { font-size: 1.4rem; display: block; margin-bottom: 2px; }
        .nav-item-custom span { font-size: 0.75rem; font-weight: 600; }
        .nav-item-custom.active { color: #ff6b81; }
        .nav-item-custom.active i { transform: translateY(-2px); }

        .sakura-card {
            background: white; border-radius: 20px; border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.04);
        }

        @keyframes sway {
            0% { transform: rotate(-1deg); }
            50% { transform: rotate(1deg); }
            100% { transform: rotate(-1deg); }
        }
        .sakura-sway { animation: sway 4s ease-in-out infinite; display: inline-block; }

        .app-header {
            background: white; padding: 15px 20px; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
        }

        @media (max-width: 570px) {
            .container {
                padding-left: 15px !important;
                padding-right: 15px !important;
                max-width: 100% !important;
            }
            h1 { font-size: 1.5rem !important; margin-bottom: 1rem !important; }
            h2 { font-size: 1.3rem !important; }
            h3 { font-size: 1.2rem !important; }
            p, span { font-size: 0.9rem !important; }

            .sakura-card, .card {
                padding: 12px !important;
                border-radius: 12px !important;
                margin-bottom: 10px !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
            }

            .sakura-card .rounded-circle, .card .rounded-circle {
                width: 45px !important;
                height: 45px !important;
                padding: 8px !important;
                margin-bottom: 8px !important;
            }
            
            .sakura-card i, .card i {
                font-size: 1.1rem !important;
            }

            .sakura-card span, .card h5 {
                font-size: 1rem !important;
                font-weight: 600 !important;
            }

            .btn {
                padding: 8px 16px !important;
                font-size: 0.9rem !important;
            }

            .fixed-bottom {
                height: 60px !important;
                padding-bottom: 5px !important;
            }
            body { padding-bottom: 70px !important; }
        }

        /* =========================================================
            DARK MODE STYLES (SIZGA YOQQAN VARIANT + TUZATISHLAR)
           ========================================================= */
        body.dark-mode {
            background-color: #121212 !important;
            color: #e0e0e0 !important;
        }

        /* 1. Oq fonli barcha elementlar */
        body.dark-mode .bg-white, 
        body.dark-mode .card, 
        body.dark-mode .sakura-card,
        body.dark-mode .question-card,
        body.dark-mode .game-header,
        body.dark-mode .list-group-item,
        body.dark-mode .bottom-nav,
        body.dark-mode .container-fluid.sticky-top,
        body.dark-mode .modal-content,
        body.dark-mode .match-card,
        body.dark-mode .rounded-circle,
        body.dark-mode .icon-box,
        body.dark-mode .input-group-text,
        body.dark-mode .app-header {
            background-color: #1e1e1e !important;
            color: #ffffff !important;
            border-color: #333 !important;
        }

        /* 2. DUMALOQ IKONKALARNING OQ AYLANALARI (Tuzatish) */
        body.dark-mode .rounded-circle, 
        body.dark-mode .icon-box,
        body.dark-mode .input-group-text {
            background-color: #2c2c2c !important;
            color: #ffffff !important;
            border-color: #444 !important;
        }

        /* 3. Matnlar uchun */
        body.dark-mode .text-dark,
        body.dark-mode h1, body.dark-mode h2, body.dark-mode h3, 
        body.dark-mode h4, body.dark-mode h5, body.dark-mode h6,
        body.dark-mode strong, body.dark-mode .fw-bold {
            color: #f8f9fa !important;
        }

        body.dark-mode .text-muted { color: #b0b0b0 !important; }

        /* 4. INPUTLAR VA PLACEHOLDER (So'z qo'shish qismi uchun tuzatish) */
        body.dark-mode .form-control,
        body.dark-mode .custom-input-group,
        body.dark-mode input,
        body.dark-mode textarea,
        body.dark-mode select {
            background-color: #2c2c2c !important;
            border-color: #444 !important;
            color: #ffffff !important;
        }

        /* Placeholder ko'rinishi uchun */
        body.dark-mode ::placeholder { color: #888 !important; opacity: 1; }

        /* 5. Tugmalar */
        body.dark-mode .btn-light,
        body.dark-mode .answer-btn {
            background-color: #2c2c2c !important;
            color: #ffffff !important;
            border: 1px solid #444 !important;
        }

        /* Alert va Progress fonlari */
        body.dark-mode .bg-warning.bg-opacity-10 { background-color: rgba(255, 193, 7, 0.2) !important; }
        body.dark-mode .bg-danger.bg-opacity-10 { background-color: rgba(220, 53, 69, 0.2) !important; }
        body.dark-mode .bg-success.bg-opacity-10 { background-color: rgba(25, 135, 84, 0.2) !important; }
        body.dark-mode .progress { background-color: #333 !important; }

    </style>
</head>
<!-- <body class="{% if request.COOKIES.theme == 'dark' %}dark-mode{% endif %}"> -->

<div class="container-fluid bg-white py-3 px-4 border-bottom sticky-top shadow-sm">
    <div class="d-flex justify-content-between align-items-center">
        <i class="bi     fs-3" style="cursor: pointer;"></i> 
        <h6 class="fw-bold mb-0 text-uppercase" style="letter-spacing: 2px;"></h6>
        <i class="bi bi-brightness-alt-low-fill fs-3" style="cursor: pointer;"></i> 
    </div>
</div>

<main>
    {% block content %}{% endblock %}
</main>

<div class="bottom-nav d-flex justify-content-around align-items-center">
    <a href="{% url 'home' %}" class="nav-item-custom {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
        <i class="bi bi-flower1"></i><span>Bosh Sahifa</span>
    </a>
    <a href="{% url 'categories' %}" class="nav-item-custom {% if 'categories' in request.path or 'dictionary' in request.path %}active{% endif %}">
        <i class="bi bi-book"></i><span>Yodlash</span>
    </a>
    <a href="{% url 'games_menu' %}" class="nav-item-custom {% if 'game' in request.path %}active{% endif %}">
        <i class="bi bi-controller"></i><span>O'yinlar</span>
    </a>
    <a href="{% url 'leaderboard' %}" class="nav-item-custom {% if request.resolver_match.url_name == 'leaderboard' %}active{% endif %}">
        <i class="bi bi-trophy"></i><span>Reyting</span>
    </a>
    <a href="{% url 'profile' %}" class="nav-item-custom {% if request.resolver_match.url_name == 'profile' %}active{% endif %}">
        <i class="bi bi-person"></i><span>Profil</span>
    </a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    /* OVOZ FUNKSIYASI */
    function speak(text) {
        let cleanText = text.replace(/\s*[\(（].*?[\)）]/g, "").trim();
        if (!('speechSynthesis' in window)) {
            alert("Uzr, telefoningiz bu funksiyani qo'llab-quvvatlamaydi.");
            return;
        }
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(cleanText);
        utterance.lang = 'ja-JP';
        utterance.rate = 0.85;
        utterance.pitch = 1;
        utterance.volume = 1;
        utterance.lang = 'ja-JP'; 

        let voices = window.speechSynthesis.getVoices();
        let japaneseVoice = voices.find(voice => voice.lang.includes('ja'));
        if (japaneseVoice) { utterance.voice = japaneseVoice; }
        window.speechSynthesis.speak(utterance);
    }

    /* TUNGI REJIM MANTIQI (Telefonda va Brauzerda xavfsiz) */
    (function() {
        const STORAGE_KEY = 'sakura_theme_vfinal';
        const body = document.body;

        const savedTheme = localStorage.getItem(STORAGE_KEY);
        if (savedTheme === 'dark') { body.classList.add('dark-mode'); }

        document.addEventListener('DOMContentLoaded', () => {
            const toggleBtn = document.getElementById('theme-toggle-btn');
            const icon = document.getElementById('theme-icon');

            if (body.classList.contains('dark-mode') && icon) {
                icon.className = 'bi bi-sun-fill text-warning fs-5';
            }

            if (toggleBtn) {
                toggleBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (body.classList.contains('dark-mode')) {
                        body.classList.remove('dark-mode');
                        localStorage.setItem(STORAGE_KEY, 'light');
                        if (icon) icon.className = 'bi bi-moon-fill text-secondary fs-5';
                    } else {
                        body.classList.add('dark-mode');
                        localStorage.setItem(STORAGE_KEY, 'dark');
                        if (icon) icon.className = 'bi bi-sun-fill text-warning fs-5';
                    }
                });
            }
        });
    })();
</script>
</body>
</html>